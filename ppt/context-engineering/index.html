<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上下文工程 (Context Engineering) 深度解析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- three.js & anime.js for background and page transitions (defer to avoid main-thread blocking during HTML parse) -->
    <script defer src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script defer src="https://unpkg.com/animejs@3.2.1/lib/anime.min.js"></script>
    <style>
        :root { --nav-h: 80px; }
        /* Ensure slides can overlap during transition to avoid layout jumps */
    #presentation-container { position: relative; width: 100%; max-width: 1200px; margin: 0 auto; padding-bottom: var(--nav-h); touch-action: pan-y; }
        /* Only the incoming slide floats above during transition */
        .slide.layer-top {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-width: 100%;
            box-sizing: border-box;
        }
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #0f172a; /* Darker blue background */
            color: #e2e8f0; /* Lighter text */
            display: block; /* override Tailwind .flex on body to prevent vertical centering shift */
            min-height: 100vh;
        }
        /* Fullscreen animated background container */
        #bg {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            /* soft starry fallback */
            background: radial-gradient(1200px 800px at 10% 10%, rgba(56,189,248,0.06), rgba(0,0,0,0)),
                        radial-gradient(1000px 700px at 90% 20%, rgba(99,102,241,0.05), rgba(0,0,0,0)),
                        radial-gradient(900px 900px at 50% 90%, rgba(52,211,153,0.05), rgba(0,0,0,0));
        }
        .slide {
            display: none;
            min-height: calc(100vh - var(--nav-h)); /* Adjust for nav (dynamic) */
            padding: 2rem;
            /* Remove CSS transitions to avoid conflicts with anime.js */
            will-change: opacity, transform;
            backface-visibility: hidden;
        }
        .slide.active {
            display: flex;
        }
        /* Preload state: render off-screen but measureable */
        .slide.preload {
            display: flex !important;
            visibility: hidden !important;
            position: absolute !important;
            left: 0;
            top: 0;
            width: 100%;
        }
        .slide-content {
            width: 100%;
            max-width: 900px;
            margin: 0 auto; /* keep centered always */
        }
        .slide-title {
            font-size: clamp(1.4rem, 4.5vw, 2.5rem);
            font-weight: 700;
            color: #38bdf8; /* Light blue for titles */
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #334155;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        ul {
            list-style-type: none;
            padding-left: 0;
        }
        li {
            margin-bottom: 1.25rem;
            padding-left: 2.5rem;
            position: relative;
            font-size: 1.125rem;
            line-height: 1.8;
        }
        li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 6px;
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.5' stroke='%2338bdf8' class='w-6 h-6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='m4.5 12.75 6 6 9-13.5' /%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }
        strong {
            color: #67e8f9; /* Lighter cyan for emphasis */
        }
        .speaker {
            font-style: italic;
            color: #94a3b8;
            margin-top: 1rem;
        }
        .nav-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(15, 23, 42, 0.8);
            /* Lower blur to reduce GPU compositing cost on low-end devices */
            backdrop-filter: blur(6px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.25rem calc(0.75rem + env(safe-area-inset-bottom));
            height: var(--nav-h);
            border-top: 1px solid #334155;
            z-index: 30;
        }
        .nav-button {
            background-color: #38bdf8;
            color: #0f172a;
            padding: 0.75rem 1.5rem;
            min-height: 44px;
            min-width: 88px;
            border-radius: 9999px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .nav-button:hover {
            background-color: #0284c7;
            transform: scale(1.05);
        }
        .nav-button:disabled {
            background-color: #334155;
            color: #64748b;
            cursor: not-allowed;
            transform: scale(1);
        }
        .slide-counter {
            font-size: 1rem;
            color: #94a3b8;
        }
        .quote {
            background-color: #1e293b;
            border-left: 4px solid #38bdf8;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            font-style: italic;
        }
        .icon {
            width: 2rem;
            height: 2rem;
            display: inline-block;
            vertical-align: middle;
        }
        /* Page transition overlay glow */
        #page-transition { display: none; }

        /* Subtle shared underline animation for slide titles (no layout shift) */
        .slide-title.shared-anim { position: relative; }
        .slide-title.shared-anim::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -2px;
            height: 2px;
            width: 100%;
            background: linear-gradient(90deg, #38bdf8, #a88dff, #3ce8a3);
            transform: scaleX(0);
            transform-origin: left;
            animation: titleSweep 320ms ease-out forwards;
            opacity: 0.75;
        }
        @keyframes titleSweep {
            to { transform: scaleX(1); }
        }

        /* Hide real titles while overlay animates to avoid duplication */
        .slide-title.hidden-during-transition { visibility: hidden; }

        /* Sticky shared title overlay */
        #shared-title-layer {
            position: fixed;
            left: 0; top: 0; /* will be set dynamically */
            z-index: 100; /* above nav and content */
            pointer-events: none;
            display: none;
            transform: translate(0,0);
            transform-origin: 0 0;
            will-change: transform, opacity;
            overflow: hidden;
        }
        #shared-title-layer .wrapper {
            width: 100%;
            margin: 0; /* positioned absolutely by layer */
            padding: 0; /* layer size already matches title rect */
        }
        #shared-title-layer .title {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: clamp(1.4rem, 4.5vw, 2.5rem);
            font-weight: 700;
            color: #38bdf8;
            border-bottom: 2px solid #334155;
            padding-bottom: 1rem;
            opacity: 0;
        }
        #shared-title-layer .title.old { opacity: 1; }

        /* === TOC Cards: improved mobile layout + accent colors === */
        .toc-list { gap: 1rem; }
        .toc-card {
            position: relative;
            display: grid;
            grid-template-columns: 40px 1fr;
            gap: 0.75rem 0.875rem;
            align-items: start;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid #334155;
            background: rgba(15,23,42,0.85);
            transition: border-color .2s ease, transform .15s ease;
        }
        .toc-card::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            border-radius: 0.75rem 0 0 0.75rem;
            background: var(--accent, #38bdf8);
            opacity: 0.9;
        }
    .toc-card { cursor: pointer; }
    .toc-card:hover { border-color: var(--accent, #38bdf8); transform: translateY(-1px); }
        .toc-icon { width: 40px; height: 40px; display: grid; place-items: center; }
        .toc-icon svg { width: 28px; height: 28px; color: var(--accent, #38bdf8); }
        .toc-text { min-width: 0; }
        .toc-kicker { display: block; font-size: 0.8rem; letter-spacing: 0.04em; color: rgba(148,163,184,0.95); margin-top: 2px; }
        .toc-title { display: block; margin-top: 4px; font-weight: 600; color: #e2e8f0; font-size: clamp(1rem, 2.2vw, 1.5rem); line-height: 1.35; }
        .toc-title strong { color: var(--accent, #38bdf8); font-weight: 700; }
        .toc-card.variant-1 { --accent: #38bdf8; }
        .toc-card.variant-2 { --accent: #8b5cf6; }
        .toc-card.variant-3 { --accent: #34d399; }
        .toc-card.variant-4 { --accent: #f59e0b; }

        /* === Hero (Slide 1) title improvements === */
        .hero-title {
            font-size: clamp(1.9rem, 6.2vw, 3rem);
            line-height: 1.2;
            text-wrap: balance;
            word-break: keep-all;
            letter-spacing: 0.01em;
        }
        .hero-subtitle {
            font-size: clamp(1.15rem, 4.2vw, 1.875rem);
            line-height: 1.35;
            text-wrap: balance;
            word-break: keep-all;
            letter-spacing: 0.005em;
        }

        /* === Action Space mini cards === */
        .action-stack.centered-stack { max-width: 860px; margin: 0 auto; }
        .action-mini {
            position: relative;
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem 0.75rem;
            align-items: start;
            padding: 0.875rem 1rem 0.875rem 1.25rem;
            border-radius: 0.75rem;
            background: #0b1220;
            border: 1px solid #2a364a;
        }
        .action-mini::before {
            content: '';
            position: absolute;
            left: 0.5rem; top: 0.75rem; bottom: 0.75rem;
            width: 3px;
            border-radius: 2px;
            background: var(--mini-accent, #38bdf8);
            opacity: 0.9;
        }
        .action-mini .mini-title { font-weight: 700; color: #e2e8f0; }
        .action-mini .mini-desc { color: #a3b2c7; margin-top: 2px; line-height: 1.6; }
        .action-mini.variant-fc { --mini-accent: #38bdf8; }
        .action-mini.variant-sb { --mini-accent: #8b5cf6; }
    .action-mini.variant-pa { --mini-accent: #34d399; }

    /* Remove check bullets and left padding within Action Space list */
    .action-stack li { padding-left: 0; }
    .action-stack li::before { content: none !important; display: none !important; }

        /* === Utility classes === */
        .centered-stack { max-width: 860px; margin-left: auto; margin-right: auto; }
        .nowrap { white-space: nowrap; }

        /* === QA cards === */
        .qa-list.centered-stack { max-width: 920px; margin: 0 auto; }
        .qa-list { display: grid; gap: 0.75rem; }
        .qa-card {
            position: relative;
            border: 1px solid #334155;
            background: rgba(15,23,42,0.85);
            border-radius: 0.75rem;
            padding: 0.875rem 1rem 0.875rem 1.25rem;
        }
        .qa-card::before {
            content: '';
            position: absolute; left: 0.5rem; top: 0.75rem; bottom: 0.75rem; width: 3px; border-radius: 2px;
            background: var(--qa-accent, #38bdf8); opacity: 0.9;
        }
        .qa-title { font-weight: 700; color: #e2e8f0; }
        .qa-body { color: #a3b2c7; margin-top: 2px; line-height: 1.65; }
        .qa-blue { --qa-accent: #38bdf8; }
        .qa-purple { --qa-accent: #8b5cf6; }
        .qa-emerald { --qa-accent: #34d399; }
        .qa-amber { --qa-accent: #f59e0b; }

    /* === Q&A Hero (Slide 15) ceremonial styling === */
    .qna-hero { position: relative; max-width: 980px; margin: 0 auto; padding: 1.25rem; }
    .qna-ring { position: absolute; inset: -36px auto auto 50%; transform: translateX(-50%); width: min(78vw, 720px); height: min(78vw, 720px); pointer-events: none; z-index: 0; opacity: 0.33; filter: blur(18px); background: radial-gradient(45% 45% at 50% 50%, rgba(139,92,246,0.55), rgba(56,189,248,0.40) 50%, rgba(20,184,166,0.32) 70%, rgba(15,23,42,0) 72%); border-radius: 50%; animation: qnaPulse 8s ease-in-out infinite; }
    @keyframes qnaPulse { 0%,100%{ opacity:.26; transform:translateX(-50%) scale(.98);} 50%{ opacity:.44; transform:translateX(-50%) scale(1.02);} }
    .qna-title { position: relative; z-index: 1; font-weight: 800; letter-spacing: .01em; font-size: clamp(2rem, 6.2vw, 3.25rem); line-height: 1.15; background: linear-gradient(90deg, #a78bfa, #7dd3fc 50%, #34d399); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 0 8px rgba(167,139,250,.16); }
    .qna-subtitle { position: relative; z-index: 1; color: #cbd5e1; font-size: clamp(1.05rem, 2.6vw, 1.25rem); }
    .qna-divider { height: 1px; opacity:.6; background: linear-gradient(90deg, rgba(139,92,246,0), rgba(139,92,246,.6), rgba(139,92,246,0)); }
    .qna-chips { position: relative; z-index: 1; display: flex; flex-wrap: wrap; justify-content: center; gap: .5rem; margin-top: .75rem; }
    .qna-chip { display: inline-flex; align-items: center; gap: .4rem; padding: .4rem .6rem; border-radius: 999px; font-size: .9rem; color: #e2e8f0; border: 1px solid #3b3f54; background: rgba(15,23,42,.6); transition: border-color .2s ease, transform .1s ease; }
    .qna-chip svg { width: 16px; height: 16px; color: #a78bfa; }
    .qna-chip:hover { border-color: #a78bfa; transform: translateY(-1px); }
    .qna-actions { position: relative; z-index: 1; display:flex; gap:.75rem; justify-content:center; flex-wrap:wrap; }
    .qna-actions .btn { border:1px solid #334155; background: rgba(15,23,42,.7); color:#e2e8f0; padding:.65rem 1rem; border-radius:.75rem; min-width:120px; transition:border-color .2s ease, transform .1s ease; }
    .qna-actions .btn:hover { border-color:#a78bfa; transform: translateY(-1px); }
    .qna-actions .btn.primary { border-color:#a78bfa; color:#ede9fe; }
    /* Q&A title dual-mode */
    .qna-title-short { display: none; }
    .qna-title-desktop { display: block; }

        /* === Finale (Slide 20) ceremonial styling === */
        .finale-wrap { position: relative; max-width: 920px; margin: 0 auto; padding: 1.25rem; }
        .finale-ring {
            position: absolute; inset: -40px auto auto 50%; transform: translateX(-50%);
            width: min(78vw, 780px); height: min(78vw, 780px);
            pointer-events: none; z-index: 0; opacity: 0.35;
            filter: blur(20px);
            background: radial-gradient(45% 45% at 50% 50%, rgba(56,189,248,0.55), rgba(139,92,246,0.35) 45%, rgba(52,211,153,0.3) 70%, rgba(15,23,42,0) 72%);
            border-radius: 50%;
            animation: finalePulse 6s ease-in-out infinite;
        }
        @keyframes finalePulse {
            0%, 100% { opacity: 0.28; transform: translateX(-50%) scale(0.98); }
            50% { opacity: 0.44; transform: translateX(-50%) scale(1.02); }
        }
        .finale-title {
            position: relative; z-index: 1;
            font-size: clamp(1.75rem, 6.2vw, 3.5rem);
            line-height: 1.15; font-weight: 800; letter-spacing: 0.01em;
            background: linear-gradient(90deg, #7dd3fc, #c4b5fd 45%, #6ee7b7);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            text-shadow: 0 0 8px rgba(125,211,252,0.15);
            animation: finaleShine 8s linear infinite;
        }
        @keyframes finaleShine {
            0% { filter: drop-shadow(0 0 0 rgba(125,211,252,0.0)); }
            50% { filter: drop-shadow(0 0 10px rgba(125,211,252,0.22)); }
            100% { filter: drop-shadow(0 0 0 rgba(125,211,252,0.0)); }
        }
        .finale-subtitle { position: relative; z-index: 1; color: #cbd5e1; font-size: clamp(1.05rem, 2.7vw, 1.25rem); }
        .finale-note { position: relative; z-index: 1; color: #94a3b8; }
        .finale-actions { position: relative; z-index: 1; display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap; }
        .finale-actions .btn {
            border: 1px solid #334155; background: rgba(15,23,42,0.7);
            color: #e2e8f0; padding: 0.65rem 1rem; border-radius: 0.75rem; min-width: 120px;
            transition: border-color .2s ease, transform .1s ease;
        }
        .finale-actions .btn:hover { border-color: #38bdf8; transform: translateY(-1px); }
        .finale-actions .btn.primary { border-color: #38bdf8; color: #e0f2fe; }
        .finale-divider { height: 1px; background: linear-gradient(90deg, rgba(56,189,248,0), rgba(56,189,248,0.6), rgba(56,189,248,0)); opacity: 0.6; }

        /* Ensure media elements scale on small screens */
        .slide-content img,
        .slide-content video,
        .slide-content iframe { max-width: 100%; height: auto; border-radius: 0.375rem; }

        /* Mobile tweaks */
        @media (max-width: 640px) {
            :root { --nav-h: calc(64px + env(safe-area-inset-bottom)); }
            .slide { padding: 1rem; }
            .slide-content { max-width: 100%; }
            .slide-title,
            #shared-title-layer .title { font-size: clamp(1.25rem, 4.8vw, 1.75rem); }
            .slide-title { gap: 0.75rem; padding-bottom: 0.75rem; }
            .finale-title { white-space: nowrap; font-size: clamp(1.5rem, 6vw, 2.25rem); letter-spacing: 0; }
            /* On mobile, show short Q&A title (<= 8 chars) and keep single line */
            .qna-title-desktop { display: none !important; }
            .qna-title-short { display: block !important; white-space: nowrap; font-size: clamp(1.5rem, 6vw, 2.25rem); letter-spacing: 0; }
            li { font-size: 1rem; padding-left: 2rem; }
            li::before { width: 16px; height: 16px; top: 6px; }
            .nav-controls { padding: 0.5rem 1rem calc(0.5rem + env(safe-area-inset-bottom)); }
            .nav-button { padding: 0.6rem 1rem; min-width: 72px; }
            .slide-counter { font-size: 0.9rem; }
            .slide-content h1 { font-size: 2rem !important; line-height: 1.2; }
            .slide-content h2 { font-size: 1.25rem !important; line-height: 1.35; }
            .quote { font-size: 0.95rem; }
            /* Disable shared-title overlay on small screens to avoid size flicker */
            #shared-title-layer { display: none !important; }
            .slide-title.hidden-during-transition { visibility: visible; }
        }
    </style>
</head>
<body class="w-full min-h-screen p-4">
    <!-- Animated Background (Genshin themed) -->
    <div id="bg"></div>

    <!-- Slide Container -->
    <div id="presentation-container">

        <!-- Slide 1: Title -->
        <div class="slide active">
            <div class="slide-content text-center">
                <h1 class="text-5xl font-bold text-sky-400 hero-title">上下文工程 <span class="nowrap">(Context Engineering)</span></h1>
                <h2 class="text-3xl mt-4 text-gray-300 hero-subtitle">深度解析与前沿实践</h2>
                <p class="mt-12 text-xl text-gray-400">演讲者:</p>
                <p class="mt-4 text-2xl"><strong>Lance</strong> (LangChain 创始工程师)</p>
                <p class="mt-2 text-2xl"><strong>Peak</strong> (Manus 联合创始人 & 首席科学家)</p>
                <!-- Reference Card -->
                <div class="mt-14 flex justify-center">
                    <div class="bg-slate-900/60 border border-slate-700/70 rounded-2xl shadow-lg p-5 w-full max-w-2xl backdrop-blur">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-sky-400"><path d="M6.32 2.577A2.25 2.25 0 0 1 8.25 2h7.5a2.25 2.25 0 0 1 2.25 2.25v15.076a.75.75 0 0 1-1.19.613L12 15.75 7.19 19.94a.75.75 0 0 1-1.19-.613V4.25c0-.606.24-1.187.66-1.673l-.34.34Z"/></svg>
                                <h3 class="text-lg font-semibold text-sky-300">参考资料</h3>
                            </div>
                        </div>
                        <div class="mt-4 space-y-4 text-left">
                            <!-- Item: YouTube -->
                            <div class="flex items-start gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-rose-400 flex-none"><path d="M19.635 7.352a2.753 2.753 0 0 0-1.94-1.948C16.26 5 12 5 12 5s-4.26 0-5.695.404a2.753 2.753 0 0 0-1.94 1.948C4 8.79 4 12 4 12s0 3.21.365 4.648c.252.963.996 1.718 1.94 1.948C7.74 19 12 19 12 19s4.26 0 5.695-.404c.944-.23 1.688-.985 1.94-1.948C20 15.21 20 12 20 12s0-3.21-.365-4.648ZM10.5 9.75l4.5 2.25-4.5 2.25v-4.5Z"/></svg>
                                <div class="min-w-0 flex-1">
                                    <div class="text-slate-200 font-medium">原始访谈 · YouTube</div>
                                    <div class="text-xs text-slate-400">Context Engineering for AI Agents with LangChain and Manus · 2025-10-14</div>
                                    <a href="https://www.youtube.com/watch?v=6_BcCthVvb8" target="_blank" class="block mt-1 text-sky-400 hover:text-sky-300 transition-colors truncate">https://www.youtube.com/watch?v=6_BcCthVvb8</a>
                                </div>
                                <button class="copy-ref inline-flex items-center gap-1 rounded-full bg-slate-700/80 text-slate-100 px-3 py-1.5 text-xs hover:bg-slate-600 active:scale-95 transition" aria-label="复制链接" title="复制：https://www.youtube.com/watch?v=6_BcCthVvb8" data-clipboard-text="https://www.youtube.com/watch?v=6_BcCthVvb8">
                                    复制链接
                                </button>
                            </div>
                            <!-- Item: WeChat Article -->
                            <div class="flex items-start gap-3">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-emerald-400 flex-none"><path d="M19.5 3.75h-15a.75.75 0 0 0-.75.75v12a.75.75 0 0 0 .75.75H9.75l2.25 3 2.25-3h5.25a.75.75 0 0 0 .75-.75v-12a.75.75 0 0 0-.75-.75Zm-12 3h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1 0-1.5Zm0 3h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1 0-1.5Zm0 3h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1 0-1.5Z"/></svg>
                                <div class="min-w-0 flex-1">
                                    <div class="text-slate-200 font-medium">内容整理 · 公众号</div>
                                    <div class="text-xs text-slate-400">作者：孔某人 · 公众号：孔某人的低维认知</div>
                                    <a href="https://mp.weixin.qq.com/s/ZYrOcuBBB2u1lsWtOb8rFQ" target="_blank" class="block mt-1 text-sky-400 hover:text-sky-300 transition-colors truncate">https://mp.weixin.qq.com/s/ZYrOcuBBB2u1lsWtOb8rFQ</a>
                                </div>
                                <button class="copy-ref inline-flex items-center gap-1 rounded-full bg-slate-700/80 text-slate-100 px-3 py-1.5 text-xs hover:bg-slate-600 active:scale-95 transition" aria-label="复制链接" title="复制：https://mp.weixin.qq.com/s/ZYrOcuBBB2u1lsWtOb8rFQ" data-clipboard-text="https://mp.weixin.qq.com/s/ZYrOcuBBB2u1lsWtOb8rFQ">
                                    复制链接
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 2: Table of Contents -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                    演讲目录
                </h2>
                <div class="mt-12 toc-list flex flex-col">
                    <div class="toc-card variant-1" data-target="2">
                        <div class="toc-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>
                        </div>
                        <div class="toc-text">
                            <span class="toc-kicker">Part 1</span>
                            <span class="toc-title"><strong>概念篇：</strong>什么是上下文工程？</span>
                        </div>
                    </div>
                    <div class="toc-card variant-2" data-target="3">
                        <div class="toc-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h12A2.25 2.25 0 0 0 20.25 14.25V3M3.75 21h16.5M16.5 3.75h.008v.008H16.5V3.75Z" /></svg>
                        </div>
                        <div class="toc-text">
                            <span class="toc-kicker">Part 2</span>
                            <span class="toc-title"><strong>全景篇：</strong>核心技术概览</span>
                        </div>
                    </div>
                    <div class="toc-card variant-3" data-target="8">
                        <div class="toc-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M12 21.75V19.5m-5.834-.166 1.591-1.591M3.75 10.5H6M12 6.75a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9Z" /></svg>
                        </div>
                        <div class="toc-text">
                            <span class="toc-kicker">Part 3</span>
                            <span class="toc-title"><strong>实践篇：</strong>来自 Manus 的前沿经验</span>
                        </div>
                    </div>
                    <div class="toc-card variant-4" data-target="14">
                        <div class="toc-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443h2.882c1.609 0 2.908-1.399 2.908-3.226s-1.299-3.226-2.908-3.226H9.497a1.526 1.526 0 0 0-1.037.443L4.984 12.76Zm15.32 0c0-1.6-1.123-2.994-2.707-3.227-1.087-.16-2.185-.283-3.293-.369V6l-4.076 4.076a1.526 1.526 0 0 0-1.037.443H5.084c-1.609 0-2.908 1.399-2.908 3.226s-1.299 3.226-2.908 3.226h2.882c.343 0 .676-.144 1.037-.443L12 17.24V15.02a1.526 1.526 0 0 1 .831-1.431l1.443-.825Z" /></svg>
                        </div>
                        <div class="toc-text">
                            <span class="toc-kicker">Part 4</span>
                            <span class="toc-title"><strong>问答篇：</strong>Q&A 精华</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3: What is Context Engineering? (moved before overview) -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">什么是上下文工程？</h2>
                <ul>
                    <li>一个随 <strong>ChatGPT</strong> 和 <strong>Agent</strong> 概念兴起的新学科。</li>
                    <li>核心挑战：Agent 在自主循环中调用工具，会导致上下文（Context）<strong>爆炸式增长</strong>。</li>
                    <li>典型任务可能需要 <strong>50次</strong> 工具调用，生产环境 Agent 可能有数百轮对话。</li>
                    <li><strong>上下文腐烂 (Context Rot)</strong>：随着上下文增长，模型性能会下降，出现重复、推理变慢、质量下降等问题。</li>
                </ul>
                <p class="speaker">- Lance</p>
            </div>
        </div>

        <!-- Slide 4: Context Engineering Overview (moved after concept) -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M2.25 12a8.954 8.954 0 0 1 0-1.591M21.75 12a8.954 8.954 0 0 0 0-1.591M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                    上下文工程核心技术全景
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
                    <!-- Card 1: Offloading -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-sky-500 transition-all duration-300">
                        <div class="flex items-center text-sky-400 mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3v11.25" /></svg>
                            <h3 class="text-xl font-bold">卸载 (Offload)</h3>
                        </div>
                        <p class="text-slate-300">将大块信息（如工具输出）移出上下文，存到外部（如文件），仅保留引用。</p>
                    </div>
                    <!-- Card 2: Reducing -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-sky-500 transition-all duration-300">
                        <div class="flex items-center text-sky-400 mb-3">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M7.848 8.25l1.536 1.536m-1.536-1.536a3 3 0 1 0-4.242 4.242l1.536-1.536m0 0L9.384 9.786m-1.536-1.536L6.312 8.25m2.072 2.072 1.536 1.536m0 0a3 3 0 1 0 4.242-4.242l-1.536 1.536m0 0L14.616 9.786m1.536 1.536L17.688 8.25m-2.072 2.072-1.536-1.536" /></svg>
                            <h3 class="text-xl font-bold">精简 (Reduce)</h3>
                        </div>
                        <p class="text-slate-300">通过总结(Summarization)、压缩(Compaction)或修剪(Pruning)来减少上下文长度。</p>
                    </div>
                    <!-- Card 3: Retrieving -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-sky-500 transition-all duration-300">
                        <div class="flex items-center text-sky-400 mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg>
                            <h3 class="text-xl font-bold">检索 (Retrieve)</h3>
                        </div>
                        <p class="text-slate-300">在需要时，按需从外部存储中获取相关信息，重新注入上下文。</p>
                    </div>
                     <!-- Card 4: Isolation -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-sky-500 transition-all duration-300">
                        <div class="flex items-center text-sky-400 mb-3">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9 3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25" /></svg>
                            <h3 class="text-xl font-bold">隔离 (Isolate)</h3>
                        </div>
                        <p class="text-slate-300">使用多 Agent 架构，每个 Agent 拥有独立的上下文窗口，分离关注点，防止干扰。</p>
                    </div>
                    <!-- Card 5: Caching -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-sky-500 transition-all duration-300">
                        <div class="flex items-center text-sky-400 mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="m3.75 13.5 10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75Z" /></svg>
                            <h3 class="text-xl font-bold">缓存 (Cache)</h3>
                        </div>
                        <p class="text-slate-300">利用 KV Cache 等技术，避免重复计算共同的前缀，降低成本和延迟。</p>
                    </div>
                     <!-- Card 6: Interplay -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-sky-500 transition-all duration-300">
                        <div class="flex items-center text-sky-400 mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 mr-3"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5 3 11.25l3.75 3.75M17.25 7.5 21 11.25l-3.75 3.75M12 19.5V4.5" /></svg>
                            <h3 class="text-xl font-bold">平衡 (Balance)</h3>
                        </div>
                        <p class="text-slate-300">以上技术相互关联，需要在多个潜在冲突的目标之间找到完美平衡。</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 5: Definition -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">定义：一门精妙的艺术与科学</h2>
                 <div class="quote">
                    <p>将上下文工程理解为一门精妙的艺术和科学，用<strong>恰当的信息</strong>填充上下文窗口以支持<strong>下一步操作</strong>。</p>
                </div>
                <ul>
                    <li>目标是管理和对抗上下文爆炸，在所有时间点为 Agent 呈现正确的信息，让它做出正确的下一步决策。</li>
                </ul>
                <p class="speaker">- Lance (引用 Karpathy)</p>
            </div>
        </div>

        <!-- Slide 6: Technique 1 - Offloading -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">核心技术 1: 上下文卸载 (Offloading)</h2>
                <ul>
                    <li>核心思想：并非所有上下文都需要存在于消息历史中。</li>
                    <li>可以将信息<strong>卸载</strong>到上下文窗口之外的地方，需要时再检索。</li>
                    <li>最流行的方法：使用<strong>文件系统</strong>。例如，将 Token 消耗大的 Web 搜索结果存入文件，只向 Agent 返回文件路径。</li>
                    <li>应用案例：Manus, OpenDevin, Claude Code, LangChain Agents 等。</li>
                </ul>
                <p class="speaker">- Lance</p>
            </div>
        </div>

        <!-- Slide 7: Technique 2 - Reducing -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">核心技术 2: 上下文精简 (Reducing)</h2>
                <ul>
                    <li>核心思想：对信息进行<strong>总结</strong>或<strong>压缩</strong>。</li>
                    <li><strong>总结工具调用输出</strong>：将冗长的结果提炼成精华。</li>
                    <li><strong>修剪 (Pruning)</strong>：移除旧的或不那么重要的工具调用及其输出。</li>
                    <li><strong>历史压缩 (Compaction)</strong>：当上下文达到某个阈值时，对整个消息历史进行总结。</li>
                    <li>应用案例：Claude Sonnet 4.5 (内置修剪), Claude Code (Compaction), Cognition。</li>
                </ul>
                <p class="speaker">- Lance</p>
            </div>
        </div>

        <!-- Slide 8: Technique 3 & 4 - Retrieving & Isolation -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">核心技术 3 & 4: 检索与隔离</h2>
                <ul>
                    <li><strong>上下文检索 (Retrieving)</strong>：为 Agent 按需获取上下文。
                        <ul class="mt-4 space-y-2">
                            <li><span class="text-sky-400 font-semibold">方法1:</span> 索引和语义搜索 (如 Vector DB)。</li>
                            <li><span class="text-sky-400 font-semibold">方法2:</span> 文件系统和简单搜索工具 (如 glob, grep)。</li>
                        </ul>
                    </li>
                    <li class="mt-6"><strong>上下文隔离 (Isolation)</strong>：通过 <strong>Multi-agents</strong> 分离上下文，每个 Sub-agent 拥有自己的上下文窗口，实现关注点分离。</li>
                </ul>
                 <p class="speaker">- Lance</p>
            </div>
        </div>

        <!-- Slide 9: Peak's Talk Intro -->
        <div class="slide">
            <div class="slide-content text-center">
                <h2 class="slide-title mx-auto">来自 Manus 的前沿经验</h2>
                 <div class="quote">
                    <p>"今天我想深入探讨一些我之前要么没有深入讨论，要么根本没有涉及的领域。我们会关注那些<strong>非共识</strong>的想法，因为探索它们往往会带来最大的启发。"</p>
                </div>
                <p class="text-2xl mt-8"><strong>Peak</strong></p>
                <p class="text-xl text-gray-400">Manus 联合创始人 & 首席科学家</p>
            </div>
        </div>

        <!-- Slide 10: Why CE vs Finetuning -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">为什么需要上下文工程 (而非微调)？</h2>
                <ul>
                    <li><strong>陷阱1：从头训练模型</strong>：产品创新速度完全受限于模型迭代速度 (通常1-2周)，且可能在不重要的基准上空耗。</li>
                    <li><strong>陷阱2：微调基础模型</strong>：强化学习 (RL) 通常需要固定 Action Space，但在 Agent 早期阶段，产品可能因新技术（如 MCP）而巨变，导致模型作废。</li>
                    <li><strong>结论</strong>：上下文工程是当前<strong>应用</strong>和<strong>模型</strong>之间最清晰、最实用的边界。创业公司应尽可能长时间地依赖它。</li>
                </ul>
                <p class="speaker">- Peak</p>
            </div>
        </div>

        <!-- Slide 11: Compaction vs Summarization -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">精简技术深潜：压实 vs. 总结</h2>
                <ul>
                    <li><strong>压实 (Compaction)</strong>：一种<strong>可逆</strong>的精简。将信息外部化（如存入文件），只保留引用（如文件路径）。没有信息真正丢失。</li>
                    <li><strong>总结 (Summarization)</strong>：一种<strong>不可逆</strong>的精简。会真正丢失信息，需非常小心使用。</li>
                    <li><strong>策略</strong>：
                        <ol class="list-decimal pl-5 mt-4 text-base space-y-2">
                            <li>达到“预腐烂”阈值 (如 128k-200k tokens) 时触发。</li>
                            <li>先对最旧的 50% 内容进行<strong>压实</strong>。</li>
                            <li>如果压实收益甚微，再对（压实前的）完整内容进行<strong>总结</strong>。</li>
                            <li>始终保留最近几个工具调用的<strong>完整细节</strong>，以保证 Agent 行为连贯。</li>
                        </ol>
                    </li>
                </ul>
                <p class="speaker">- Peak</p>
            </div>
        </div>

        <!-- Slide 12: Isolation Deep Dive -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">隔离技术深潜：通信 vs. 共享内存</h2>
                <div class="quote">
                    <p>"不要通过共享内存来通信。相反，通过通信来共享内存。" - Go 语言社区</p>
                </div>
                <ul>
                    <li><strong>通过通信 (By Communicating)</strong>：经典的 Sub-agent 模式。主 Agent 发送清晰指令，Sub-agent 在隔离的上下文中完成任务，只返回最终结果。适用于<strong>简单、独立的任务</strong>。</li>
                    <li><strong>通过共享内存 (By Sharing Context)</strong>：Sub-agent 可以看到<strong>完整的历史上下文</strong>，但有自己的系统提示和 Action Space。适用于<strong>需要大量历史信息的复杂任务</strong>（如 Deep Research）。</li>
                </ul>
                 <p class="speaker">- Peak</p>
            </div>
        </div>

        <!-- Slide 13: Offloading Tools -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">卸载技术深潜：分层的 Action Space</h2>
                <ul class="space-y-3 action-stack centered-stack">
                    <li><strong>问题</strong>：工具太多会导致“上下文混乱”，模型可能调用错误或不存在的工具。动态加载工具会破坏 KV Cache。</li>
                    <li><strong>Manus 的方案</strong>：将 Action Space 分为三个抽象层级，卸载工具本身。</li>
                    <li class="!list-none mt-4 -ml-2">
                        <div class="action-mini variant-fc">
                            <div class="mini-text">
                                <div class="mini-title">层级 1: Function Calling</div>
                                <div class="mini-desc">仅保留少数（10-20个）核心原子函数，如读写文件、执行 shell、搜索。保证 schema 安全且对 Cache 友好。</div>
                            </div>
                        </div>
                    </li>
                    <li class="!list-none mt-2 -ml-2">
                        <div class="action-mini variant-sb">
                            <div class="mini-text">
                                <div class="mini-title">层级 2: Sandbox Utilities</div>
                                <div class="mini-desc">在虚拟机沙箱中预装大量命令行工具。Agent 通过 shell 命令调用。可无限扩展能力而不污染函数空间。</div>
                            </div>
                        </div>
                    </li>
                    <li class="!list-none mt-2 -ml-2">
                        <div class="action-mini variant-pa">
                            <div class="mini-text">
                                <div class="mini-title">层级 3: Packages & APIs</div>
                                <div class="mini-desc">Agent 编写并执行脚本来调用第三方库和 API。适用于需要大量计算或内存的任务。</div>
                            </div>
                        </div>
                    </li>
                </ul>
                 <p class="speaker">- Peak</p>
            </div>
        </div>

        <!-- Slide 14: Final Thought -->
        <div class="slide">
            <div class="slide-content text-center">
                <h2 class="slide-title mx-auto">最终思考：避免过度工程化</h2>
                 <div class="quote text-2xl leading-relaxed">
                    <p>我们见到的最大飞跃并非来自添加更多花哨的管理层或巧妙的技巧，而是来自<strong>简化</strong>，来自<strong>移除不必要的技巧</strong>并<strong>更多地信任模型</strong>。</p>
                </div>
                <p class="mt-8 text-3xl font-bold text-sky-300">少构建，多理解。</p>
                <p class="speaker mt-8">- Peak</p>
            </div>
        </div>

        <!-- Slide 15: Q&A Title (Hero) -->
        <div class="slide">
            <div class="slide-content text-center">
                <div class="qna-hero">
                    <div class="qna-ring" aria-hidden="true"></div>
                    <h1 class="qna-title qna-title-desktop">问答篇：Q&A 精华</h1>
                    <h1 class="qna-title qna-title-short">Q&A 精华</h1>
                    <div class="mt-6 qna-divider"></div>
                    <p class="mt-6 qna-subtitle">从真实场景出发，聚焦工具、记忆、模型、规划与安全的关键抉择。</p>
                    <div class="qna-chips mt-4">
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25 20.485 6.75 12 11.25 3.515 6.75 12 2.25Zm8.485 8.25L12 15.75 3.515 10.5 12 6.75l8.485 3.75ZM12 17.25l8.485-4.5V17.25L12 21.75 3.515 17.25V12.75L12 17.25Z"/></svg>
                            工具调用
                        </span>
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4.5 5.25A2.25 2.25 0 0 1 6.75 3h10.5A2.25 2.25 0 0 1 19.5 5.25v13.5A2.25 2.25 0 0 1 17.25 21H6.75A2.25 2.25 0 0 1 4.5 18.75V5.25Zm3 1.5h9v3h-9v-3Zm0 4.5h9v6h-9v-6Z"/></svg>
                            索引与记忆
                        </span>
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a9.75 9.75 0 1 0 9.75 9.75A9.761 9.761 0 0 0 12 2.25Zm.75 15.75h-1.5v-1.5h1.5v1.5Zm1.905-7.905a3.375 3.375 0 0 0-4.41-.285 1.125 1.125 0 0 1-1.44-1.74 5.625 5.625 0 1 1 8.145 7.695 1.125 1.125 0 0 1-1.59-1.59 3.375 3.375 0 0 0 0-4.08Z"/></svg>
                            模型选择
                        </span>
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 6.75A2.25 2.25 0 0 1 5.25 4.5h13.5A2.25 2.25 0 0 1 21 6.75v10.5A2.25 2.25 0 0 1 18.75 19.5H5.25A2.25 2.25 0 0 1 3 17.25V6.75Zm3 2.25h12v6H6v-6Z"/></svg>
                            规划
                        </span>
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1.5 2.25 6.75 12 12l9.75-5.25L12 1.5Zm0 21-9.75-5.25V9L12 14.25 21.75 9v8.25L12 22.5Z"/></svg>
                            多 Agent
                        </span>
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a9.75 9.75 0 1 0 9.75 9.75A9.761 9.761 0 0 0 12 2.25Zm0 3a2.25 2.25 0 1 1-2.25 2.25A2.25 2.25 0 0 1 12 5.25Zm0 12.75a7.5 7.5 0 0 1-6-3.03 4.5 4.5 0 0 1 12 0 7.5 7.5 0 0 1-6 3.03Z"/></svg>
                            安全
                        </span>
                        <span class="qna-chip">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4.5 3.75h15v2.25h-15V3.75Zm0 5.25h15v2.25h-15V9Zm0 5.25h15V16.5h-15V14.25Z"/></svg>
                            评估
                        </span>
                    </div>
                    <div class="mt-10 qna-actions">
                        <button class="btn primary go-slide-btn" data-go="15">开始 Q&A</button>
                        <button class="btn go-slide-btn" data-go="1">回到目录</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 16: Q&A 1 -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Q&A: 工具调用、索引与长期记忆</h2>
                <div class="qa-list centered-stack">
                    <div class="qa-card qa-blue">
                        <div class="qa-title">如何调用 Shell 工具?</div>
                        <div class="qa-body">在系统提示中告知工具位置，并鼓励 Agent 使用 <code>--help</code> 自行学习用法。</div>
                    </div>
                    <div class="qa-card qa-purple">
                        <div class="qa-title">索引 vs. Grep/Glob?</div>
                        <div class="qa-body">对于会话级任务，动态构建索引太慢。Manus 依赖 <code>grep</code> 和 <code>glob</code>，更快速直接。对于企业知识库等长期记忆场景，索引是必要的。</div>
                    </div>
                    <div class="qa-card qa-emerald">
                        <div class="qa-title">长期记忆?</div>
                        <div class="qa-body">Manus 采用显式的、用户确认的“知识”系统。同时在探索从集体用户反馈中进行无参数在线学习的“自我改进”机制。</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 17: Q&A 2 -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Q&A: 架构演进、数据格式与总结技巧</h2>
                <div class="qa-list centered-stack">
                    <div class="qa-card qa-amber">
                        <div class="qa-title">如何应对模型升级?</div>
                        <div class="qa-body"><strong>不断重构</strong>。通过在强弱模型间切换来测试架构的未来适应性，可以提前为下一代模型做准备。</div>
                    </div>
                    <div class="qa-card qa-blue">
                        <div class="qa-title">最佳数据格式?</div>
                        <div class="qa-body">优先考虑<strong>基于行的格式</strong>（如纯文本），因为它允许模型使用 <code>grep</code> 或按行读取，比 Markdown 更稳定。</div>
                    </div>
                    <div class="qa-card qa-purple">
                        <div class="qa-title">如何做好总结?</div>
                        <div class="qa-body">不要用自由形式的 Prompt。定义一个结构化的 <strong>Schema</strong>（像表单），让 AI 填写关键字段，输出更稳定可靠。</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 18: Q&A 3 -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Q&A: Agent 通信、模型选择与规划</h2>
                <div class="qa-list centered-stack">
                    <div class="qa-card qa-emerald">
                        <div class="qa-title">Agent 间如何通信?</div>
                        <div class="qa-body">通过共享沙箱（文件系统）和<strong>契约 (Schema)</strong>。主 Agent 定义输出 Schema，Sub-agent 使用约束解码来确保返回符合格式的数据。</div>
                    </div>
                    <div class="qa-card qa-blue">
                        <div class="qa-title">模型选择?</div>
                        <div class="qa-body">旗舰模型因其全球分布式 KV Cache 基础设施，在 Agent 场景（输入远长于输出）下可能<strong>比开源模型更具成本效益</strong>。不同模型擅长不同任务，应做任务级路由。</div>
                    </div>
                    <div class="qa-card qa-purple">
                        <div class="qa-title">规划 (Planning)?</div>
                        <div class="qa-body">从浪费 Token 的 <code>todo.md</code> 范式，演进为由一个独立的 <strong>Planner Agent</strong>（Agent as Tool）进行更结构化的规划。</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 19: Q&A 4 -->
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Q&A: 多 Agent 设计、安全与评估</h2>
                <div class="qa-list centered-stack">
                    <div class="qa-card qa-amber">
                        <div class="qa-title">多 Agent 设计?</div>
                        <div class="qa-body">避免拟人化（如设计师、程序员 Agent）。Manus 采用少数<strong>功能性 Agent</strong>（执行器、规划器、知识管理器），而非按角色划分。</div>
                    </div>
                    <div class="qa-card qa-emerald">
                        <div class="qa-title">安全性?</div>
                        <div class="qa-body"><strong>沙箱是核心</strong>。严格控制出站流量，对敏感操作要求用户手动确认。与模型提供商合作，利用其内置的 Guardrails。</div>
                    </div>
                    <div class="qa-card qa-blue">
                        <div class="qa-title">如何评估 (Eval)?</div>
                        <div class="qa-body"><strong>用户反馈是金标准</strong>（1-5星评分）。结合内部自动化测试集和大量人工（实习生）评估主观输出（如 UI 美观度）。</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 20: Finale -->
        <div class="slide">
            <div class="slide-content text-center">
                <div class="finale-wrap">
                    <div class="finale-ring" aria-hidden="true"></div>
                    <h1 class="finale-title">感谢观看</h1>
                    <div class="mt-6 finale-divider"></div>
                    <p class="mt-8 finale-subtitle">愿我们以更少的技巧，更深的理解，构建真正有用的智能系统。</p>
                    <p class="mt-4 finale-note">少构建 · 多理解 · Keep It Simple</p>
                    <div class="mt-10 finale-actions">
                        <button class="btn primary go-slide-btn" data-go="0">返回首页</button>
                        <button class="btn go-slide-btn" data-go="1">回到目录</button>
                        <button class="btn copy-ref copy-current-url" data-clipboard-text="" title="复制当前链接">复制链接</button>
                    </div>
                    <!-- Author Info -->
                    <div class="mt-8 text-sm text-slate-400">
                        作者：<span class="font-semibold text-slate-300">兮尘</span>
                        · 主页：
                        <a href="https://linxueyuan.online/" target="_blank" rel="noopener noreferrer" class="text-sky-400 hover:text-sky-300">https://linxueyuan.online/</a>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- Page transition overlay -->
    <div id="page-transition"></div>

    <!-- Shared Title Overlay (sticky shared-element during transitions) -->
    <div id="shared-title-layer" aria-hidden="true">
        <div class="wrapper">
            <div class="title old"></div>
            <div class="title new"></div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-controls">
        <button id="prev-btn" class="nav-button">上一页</button>
        <div id="slide-counter" class="slide-counter">1 / 20</div>
        <button id="next-btn" class="nav-button">下一页</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const slides = document.querySelectorAll('.slide');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const slideCounter = document.getElementById('slide-counter');
            const pageOverlay = document.getElementById('page-transition');
            const container = document.getElementById('presentation-container');
            const sharedTitleLayer = document.getElementById('shared-title-layer');
            const sharedTitleOld = sharedTitleLayer.querySelector('.title.old');
            const sharedTitleNew = sharedTitleLayer.querySelector('.title.new');
            let currentSlide = 0;
            const totalSlides = slides.length;
            let isAnimating = false;
            const heightsCache = Object.create(null);

            function updateNavState(index) {
                slideCounter.textContent = `${index + 1} / ${totalSlides}`;
                prevBtn.disabled = index === 0;
                nextBtn.disabled = index === totalSlides - 1;
            }

            function pageGlow() { /* disabled per UX request to avoid white flash */ }

            function showSlide(index) {
                if (index === currentSlide || isAnimating) return;
                const from = slides[currentSlide];
                const to = slides[index];
                isAnimating = true;
                prevBtn.disabled = true;
                nextBtn.disabled = true;

                // Lock container height/width to avoid squeeze during transition
                const fromH = container.offsetHeight;
                container.style.height = fromH + 'px';
                container.style.width = '100%';
                container.style.overflow = 'hidden';

                // Determine target height (use cache or measure without visual change)
                let toH = heightsCache[index];
                if (toH == null) {
                    // Ensure measurement at intended width
                    const prevTrans = container.classList.contains('transitioning');
                    container.classList.add('transitioning');
                    to.classList.add('preload');
                    toH = to.offsetHeight;
                    to.classList.remove('preload');
                    if (!prevTrans) container.classList.remove('transitioning');
                    heightsCache[index] = toH;
                }

                // Prepare next slide for crossfade (opacity only)
                // Shared sticky title overlay setup (measure BEFORE activating next slide)
                const fromTitle = from.querySelector('.slide-title');
                const toTitle = to.querySelector('.slide-title');
                let useSharedTitle = false;
                let fromRect, toRect;
                const isSmallScreen = window.matchMedia && window.matchMedia('(max-width: 640px)').matches;
                if (!isSmallScreen && fromTitle && toTitle && window.anime) {
                    useSharedTitle = true;
                    fromRect = fromTitle.getBoundingClientRect();
                    // We'll measure toRect later only if needed; for now we don't move overlay
                    // Hide real titles during transition
                    fromTitle.classList.add('hidden-during-transition');
                    // Keep new title in DOM; fade it in underneath to avoid movement
                    toTitle.style.opacity = 0;
                    toTitle.style.willChange = 'opacity';
                    // Fill overlay contents (ensure old content captured before DOM changes)
                    sharedTitleOld.innerHTML = fromTitle.innerHTML;
                    sharedTitleNew.innerHTML = '';
                    // Position and show overlay
                    // Place overlay at the OLD title's rect and keep it fixed (no movement)
                    // Clamp within viewport to avoid off-screen flash on edge cases
                    const safeLeft = Math.max(0, Math.round(fromRect.left));
                    const safeTop = Math.max(0, Math.round(fromRect.top));
                    if (!isFinite(safeLeft) || !isFinite(safeTop)) {
                        useSharedTitle = false;
                    } else {
                        sharedTitleLayer.style.left = safeLeft + 'px';
                        sharedTitleLayer.style.top = safeTop + 'px';
                    }
                    sharedTitleLayer.style.width = Math.round(fromRect.width) + 'px';
                    sharedTitleLayer.style.height = Math.round(fromRect.height) + 'px';
                    sharedTitleLayer.style.display = 'block';
                    // Reset states
                    sharedTitleOld.style.opacity = 1;
                    sharedTitleNew.style.opacity = 0;
                }

                // Now make next slide visible for crossfade
                to.style.opacity = 0;
                to.classList.add('active');

                // Float incoming slide above without affecting layout (after measuring final rect)
                to.classList.add('layer-top');

                // Animate out current, then in next
                if (window.anime) {
                    // Crossfade out current slide
                    anime({
                        targets: from,
                        opacity: [1, 0],
                        duration: 180,
                        easing: 'linear',
                        complete: () => {
                            from.classList.remove('active');
                            from.style.opacity = '';
                        }
                    });

                    // Fade in target slide
                    anime({
                        targets: to,
                        opacity: [0, 1],
                        duration: 220,
                        easing: 'linear',
                        complete: () => {
                            currentSlide = index;
                            updateNavState(currentSlide);
                            to.style.opacity = '';
                            // Shared title underline (non-intrusive)
                            const title = to.querySelector('.slide-title');
                            if (title) {
                                title.classList.remove('shared-anim');
                                // force reflow to restart animation
                                void title.offsetWidth;
                                title.classList.add('shared-anim');
                            }
                            // Height unlock happens after height animation complete below
                        }
                    });

                    // Overlay title crossfade (sticky)
                    if (useSharedTitle) {
                        // Fade out overlay old at original position; fade in real new title at its own position
                        anime({ targets: sharedTitleOld, opacity: [1, 0], duration: 180, delay: 10, easing: 'linear' });
                        anime({ targets: toTitle, opacity: [0, 1], duration: 220, easing: 'linear' });
                    }
                    // Animate container height to target to avoid final snap
                    anime({
                        targets: container,
                        height: [fromH, toH],
                        duration: 220,
                        easing: 'easeOutCubic',
                        complete: () => {
                            container.style.height = '';
                            container.style.width = '';
                            container.style.overflow = '';
                            // switch from floating to normal flow
                            to.classList.remove('layer-top');
                            // Cleanup shared title overlay
                            if (useSharedTitle) {
                                sharedTitleLayer.style.display = 'none';
                                sharedTitleLayer.style.transform = '';
                                sharedTitleLayer.style.left = '';
                                sharedTitleLayer.style.top = '';
                                sharedTitleLayer.style.width = '';
                                sharedTitleLayer.style.height = '';
                                sharedTitleOld.innerHTML = '';
                                sharedTitleNew.innerHTML = '';
                                const ft = from.querySelector('.slide-title');
                                const tt = to.querySelector('.slide-title');
                                if (ft) ft.classList.remove('hidden-during-transition');
                                if (tt) { tt.style.opacity = ''; tt.style.willChange = ''; }
                            }
                            isAnimating = false;
                        }
                    });
                    // No overlay glow to meet UX requirement
                } else {
                    // Fallback without anime.js
                    const toH2 = (function(){
                        // rough measure by briefly showing to
                        if (heightsCache[index] == null) {
                            const prevTrans = container.classList.contains('transitioning');
                            container.classList.add('transitioning');
                            to.classList.add('preload');
                            const h = to.offsetHeight;
                            to.classList.remove('preload');
                            if (!prevTrans) container.classList.remove('transitioning');
                            heightsCache[index] = h;
                        }
                        return heightsCache[index];
                    })();
                    container.style.height = fromH + 'px';
                    from.classList.remove('active');
                    currentSlide = index;
                    updateNavState(currentSlide);
                    container.style.height = toH2 + 'px';
                    // unlock
                    container.style.height = '';
                    container.style.overflow = '';
                    to.classList.remove('layer-top');
                    container.style.width = '';
                    isAnimating = false;
                }

                // Do not force scroll to top to avoid perceived jump
            }

            // Preload neighbor slides to reduce layout work on navigation
            function preloadSlide(idx) {
                if (idx < 0 || idx >= totalSlides) return;
                if (heightsCache[idx] != null) return;
                const el = slides[idx];
                el.classList.add('preload');
                heightsCache[idx] = el.offsetHeight;
                el.classList.remove('preload');
            }

            function preloadNeighbors() {
                preloadSlide(currentSlide + 1);
                preloadSlide(currentSlide - 1);
            }

            // Initial preload
            preloadNeighbors();

            // On navigation buttons, after successful transition, update cache for new neighbors
            function afterSlideChange() {
                // Invalidate distant caches on responsive changes handled elsewhere
                preloadNeighbors();
            }

            // Hook afterSlideChange into our anime completion by monkey-patching updateNavState (non-invasive)
            const _updateNavState = updateNavState;
            updateNavState = function(i) {
                _updateNavState(i);
                // small microtask to run after DOM updates
                Promise.resolve().then(afterSlideChange);
            }

            // Invalidate cache on resize and re-preload neighbors
            window.addEventListener('resize', () => {
                for (const k in heightsCache) delete heightsCache[k];
                preloadNeighbors();
            });

            // Simple click guards to avoid flooding animations
            let clickLock = false;
            function withClickLock(fn){
                if (clickLock) return;
                clickLock = true;
                try { fn(); } finally {
                    setTimeout(() => { clickLock = false; }, 180);
                }
            }
            nextBtn.addEventListener('click', () => {
                withClickLock(() => {
                    if (currentSlide < totalSlides - 1) {
                        showSlide(currentSlide + 1);
                    }
                });
            });

            prevBtn.addEventListener('click', () => {
                withClickLock(() => {
                    if (currentSlide > 0) {
                        showSlide(currentSlide - 1);
                    }
                });
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' && !nextBtn.disabled) {
                    nextBtn.click();
                } else if (e.key === 'ArrowLeft' && !prevBtn.disabled) {
                    prevBtn.click();
                }
            });

            // TOC card navigation
            (function bindTocNavigation(){
                const cards = document.querySelectorAll('.toc-card[data-target]');
                cards.forEach(card => {
                    card.addEventListener('click', () => {
                        const t = parseInt(card.getAttribute('data-target') || '', 10);
                        if (!Number.isFinite(t)) return;
                        if (t >= 0 && t < totalSlides && t !== currentSlide) {
                            showSlide(t);
                        }
                    });
                });
            })();

            // Touch swipe navigation for mobile
            (function enableSwipeNavigation(){
                let sx = null, sy = null, st = 0, gestureLock = false;
                const THRESH_X = 50, THRESH_Y = 40, THRESH_T = 600; // px / ms
                container.addEventListener('touchstart', (e) => {
                    if (e.touches.length !== 1) { sx = sy = null; return; }
                    const t = e.touches[0];
                    sx = t.clientX; sy = t.clientY; st = Date.now();
                    const target = e.target;
                    gestureLock = !!(target && target.closest && target.closest('a, button, input, textarea, select'));
                }, { passive: true });
                container.addEventListener('touchend', (e) => {
                    if (sx == null || gestureLock) { sx = sy = null; return; }
                    const t = e.changedTouches && e.changedTouches[0];
                    if (!t) { sx = sy = null; return; }
                    const dx = t.clientX - sx;
                    const dy = t.clientY - sy;
                    const dt = Date.now() - st;
                    if (Math.abs(dx) > THRESH_X && Math.abs(dy) < THRESH_Y && dt < THRESH_T) {
                        if (dx < 0 && currentSlide < totalSlides - 1) {
                            showSlide(currentSlide + 1);
                        } else if (dx > 0 && currentSlide > 0) {
                            showSlide(currentSlide - 1);
                        }
                    }
                    sx = sy = null; gestureLock = false;
                }, { passive: true });
            })();

            // Initial setup
            updateNavState(currentSlide);
            // Ensure initial active state
            slides.forEach((s, i) => s.classList.toggle('active', i === 0));

            // Respect reduced motion preferences
            const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (prefersReduced) {
                // Disable fancy overlay and use instant showSlide
                pageGlow = function(){};
            }

            // =====================
            // three.js Cute Background (Genshin-themed)
            // =====================
            try {
                // Respect reduced motion and low-memory devices for background effects
                const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                const deviceMemGB = (navigator.deviceMemory && isFinite(navigator.deviceMemory)) ? navigator.deviceMemory : undefined;
                const lowMemory = deviceMemGB && deviceMemGB <= 4; // treat <=4GB as low
                const lowPerf = prefersReducedMotion || lowMemory;
                if (lowPerf || !window.THREE) {
                    // Skip WebGL background entirely to save memory and avoid jank
                    throw new Error('Skipped BG due to reduced motion/low memory or THREE not loaded');
                }
                const bgEl = document.getElementById('bg');
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                // Cap device pixel ratio to lower VRAM usage; stronger cap on low-end devices
                const maxDPR = lowMemory ? 1.25 : 1.75;
                renderer.setPixelRatio(Math.min(maxDPR, window.devicePixelRatio || 1));
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000000, 0);
                bgEl.appendChild(renderer.domElement);

                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 2000);
                camera.position.z = 300;

                // Genshin element palette
                const palette = [
                    0x3ce8a3, // Anemo
                    0xf5d05f, // Geo
                    0xa88dff, // Electro
                    0x68d391, // Dendro
                    0x4cc3ff, // Hydro
                    0xff6b6b, // Pyro
                    0x6ecbf5  // Cryo
                ];

                const isMobile = window.matchMedia('(max-width: 768px)').matches;
                // Reduce particle count and radius on mobile/low-perf devices
                const baseCount = isMobile ? 380 : 1100;
                const count = lowPerf ? Math.floor(baseCount * 0.5) : baseCount;
                const radius = (isMobile ? 240 : 340) * (lowPerf ? 0.9 : 1);

                // Make a soft round sprite texture
                function makeSpriteTexture() {
                    const c = document.createElement('canvas');
                    c.width = c.height = 64;
                    const ctx = c.getContext('2d');
                    const g = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
                    g.addColorStop(0, 'rgba(255,255,255,1)');
                    g.addColorStop(0.2, 'rgba(255,255,255,0.85)');
                    g.addColorStop(1, 'rgba(255,255,255,0)');
                    ctx.fillStyle = g;
                    ctx.fillRect(0, 0, 64, 64);
                    const tex = new THREE.CanvasTexture(c);
                    tex.anisotropy = 1;
                    return tex;
                }

                const positions = new Float32Array(count * 3);
                const colors = new Float32Array(count * 3);

                function hexToRgbNorm(hex) {
                    const r = (hex >> 16) & 255,
                          g = (hex >> 8) & 255,
                          b = hex & 255;
                    return [r / 255, g / 255, b / 255];
                }

                for (let i = 0; i < count; i++) {
                    // random point inside a sphere
                    const u = Math.random();
                    const v = Math.random();
                    const theta = 2 * Math.PI * u;
                    const phi = Math.acos(2 * v - 1);
                    const r = Math.cbrt(Math.random()) * radius; // denser center
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    positions[i * 3] = x;
                    positions[i * 3 + 1] = y;
                    positions[i * 3 + 2] = z;
                    const colorHex = palette[i % palette.length];
                    const [cr, cg, cb] = hexToRgbNorm(colorHex);
                    colors[i * 3] = cr;
                    colors[i * 3 + 1] = cg;
                    colors[i * 3 + 2] = cb;
                }

                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

                const material = new THREE.PointsMaterial({
                    size: isMobile ? 1.2 : 1.7,
                    map: makeSpriteTexture(),
                    transparent: true,
                    depthWrite: false,
                    opacity: 0.85,
                    vertexColors: true,
                    blending: THREE.AdditiveBlending,
                    sizeAttenuation: true
                });

                const points = new THREE.Points(geometry, material);
                points.rotation.x = 0.2;
                scene.add(points);

                // Subtle element orbs
                const orbGroup = new THREE.Group();
                palette.forEach((hex, idx) => {
                    const orbGeo = new THREE.SphereGeometry(isMobile ? 3.2 : 4.5, 16, 16);
                    const col = new THREE.Color(hex);
                    const orbMat = new THREE.MeshBasicMaterial({ color: col, transparent: true, opacity: 0.12, blending: THREE.AdditiveBlending });
                    const orb = new THREE.Mesh(orbGeo, orbMat);
                    const ang = (idx / palette.length) * Math.PI * 2;
                    const rr = radius * 0.52;
                    orb.position.set(Math.cos(ang) * rr, Math.sin(ang) * rr * 0.6, -80 + Math.sin(idx) * 40);
                    orbGroup.add(orb);
                });
                scene.add(orbGroup);

                // Save references for page pulses
                window.__bg = { material };

                // Debounced resize to avoid repeated expensive resize
                let __resizeTimer;
                function onResize() {
                    const w = window.innerWidth;
                    const h = window.innerHeight;
                    renderer.setSize(w, h);
                    camera.aspect = w / h;
                    camera.updateProjectionMatrix();
                }
                function onResizeDebounced() {
                    clearTimeout(__resizeTimer);
                    __resizeTimer = setTimeout(onResize, 120);
                }
                window.addEventListener('resize', onResizeDebounced, { passive: true });

                let t = 0;
                let rafId = null;
                let running = true;
                function tick() {
                    if (!running) return;
                    rafId = requestAnimationFrame(tick);
                    t += 0.0025;
                    points.rotation.y += 0.0007;
                    points.rotation.x = Math.sin(t * 0.8) * 0.06 + 0.12;
                    orbGroup.rotation.y -= 0.0005;
                    orbGroup.children.forEach((o, i) => {
                        o.position.z = -80 + Math.sin(t * 2 + i) * 18;
                        o.material.opacity = 0.1 + 0.05 * (1 + Math.sin(t * 1.5 + i));
                    });
                    renderer.render(scene, camera);
                }
                // Pause when tab hidden to free CPU/GPU
                document.addEventListener('visibilitychange', () => {
                    const hidden = document.hidden;
                    if (hidden && running) {
                        running = false;
                        if (rafId) cancelAnimationFrame(rafId);
                        rafId = null;
                    } else if (!hidden && !running) {
                        running = true;
                        tick();
                    }
                });
                // Start loop
                tick();

                // Cleanup on unload to avoid stray raf and GL contexts
                window.addEventListener('beforeunload', () => {
                    running = false;
                    if (rafId) cancelAnimationFrame(rafId);
                    window.removeEventListener('resize', onResizeDebounced);
                    try { renderer.dispose(); } catch(_){}
                    try { geometry.dispose(); } catch(_){}
                    try { material.dispose(); } catch(_){}
                });
            } catch (e) {
                // three.js not available or failed: ignore gracefully
                console.warn('Background init failed:', e);
            }

            // Copy reference links
            try {
                const copyBtns = document.querySelectorAll('.copy-ref');
                copyBtns.forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const text = btn.getAttribute('data-clipboard-text') || '';
                        let ok = false;
                        try {
                            if (navigator.clipboard && navigator.clipboard.writeText) {
                                await navigator.clipboard.writeText(text);
                                ok = true;
                            }
                        } catch (_) {}
                        if (!ok) {
                            // Fallback
                            const ta = document.createElement('textarea');
                            ta.value = text;
                            ta.style.position = 'fixed';
                            ta.style.left = '-9999px';
                            document.body.appendChild(ta);
                            ta.focus();
                            ta.select();
                            try { ok = document.execCommand('copy'); } catch (_) { ok = false; }
                            document.body.removeChild(ta);
                        }
                        // Feedback
                        const old = btn.textContent;
                        btn.textContent = ok ? '已复制链接' : '复制失败';
                        btn.disabled = true;
                        setTimeout(() => {
                            btn.textContent = old || '复制链接';
                            btn.disabled = false;
                        }, 1200);
                    });
                });
            } catch (_) { /* noop */ }

            // Finale actions
            try {
                // Navigation buttons
                const goBtns = document.querySelectorAll('.go-slide-btn[data-go]');
                goBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const idx = parseInt(btn.getAttribute('data-go') || '', 10);
                        if (!Number.isFinite(idx)) return;
                        if (idx >= 0 && idx < totalSlides) showSlide(idx);
                    });
                });
                // Copy current URL
                const cur = document.querySelector('.copy-current-url');
                if (cur) {
                    const url = window.location.href;
                    cur.setAttribute('data-clipboard-text', url);
                }
            } catch (_) { /* noop */ }
        });
    </script>
</body>
</html>